[
  {
    "Resources": {
      "firstLambdaServiceRoleB6408C31": {
        "Type":"AWS::IAM::Role",
        "Properties": {
          "AssumeRolePolicyDocument": {
            "Statement": [
              {
                "Action":"sts:AssumeRole",
                "Effect":"Allow",
                "Principal": {"Service":"lambda.amazonaws.com"}
              }
            ],
            "Version":"2012-10-17"
          },
          "ManagedPolicyArns": [
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {"Ref":"AWS::Partition"},
                  ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                ]
              ]
            }
          ]
        }
      },
      "firstLambda395F9ADE": {
        "Type": "AWS::Lambda::Function",
        "Properties": {
          "Code": {
            "S3Bucket": { "Ref":"firstLambdaCodeS3Bucket9779DE4A" },
            "S3Key": {
              "Fn::Join": [
                "",
                [
                  {
                    "Fn::Select": [
                      0,
                      { "Fn::Split": [ "||", { "Ref":"firstLambdaCodeS3VersionKey694A53D3" } ] }
                    ]
                  },
                  {
                    "Fn::Select": [
                      1,
                      { "Fn::Split": [ "||", { "Ref": "firstLambdaCodeS3VersionKey694A53D3" } ] }
                    ]
                  }
                ]
              ]
            }
          },
          "Handler": "index.handler",
          "Role": {
            "Fn::GetAtt": [ "firstLambdaServiceRoleB6408C31", "Arn" ]
          },
          "Runtime": "nodejs10.x",
          "FunctionName": "FirstLambda"
        },
        "DependsOn": [ "firstLambdaServiceRoleB6408C31" ]
      }
    },
    "Parameters": {
      "firstLambdaCodeS3Bucket9779DE4A": { "Type": "String", "Description": "S3 bucket for asset \"FirstStack/firstLambda/Code\"" },
      "firstLambdaCodeS3VersionKey694A53D3": { "Type": "String", "Description": "S3 key for asset version \"FirstStack/firstLambda/Code\"" },
      "firstLambdaCodeArtifactHashBD56E0CA": { "Type": "String", "Description": "Artifact hash for asset \"FirstStack/firstLambda/Code\"" }
    },
    "Outputs": {
      "ExportsOutputFnGetAttfirstLambda395F9ADEArn1A9B3BC3": {
        "Value": { "Fn::GetAtt": [ "firstLambda395F9ADE", "Arn" ] },
        "Export": { "Name": "FirstStack:ExportsOutputFnGetAttfirstLambda395F9ADEArn1A9B3BC3" }
      }
    }
  },
  {
    "Resources": {
      "BooksApi60AC975F": {
        "Type":"AWS::ApiGateway::RestApi",
        "Properties": { "Name":"SecondRestAPI" }
      },
      "BooksApiDeployment86CA39AF794fe41ee968b295eca9a15ee72a4a7c": {
        "Type":"AWS::ApiGateway::Deployment",
        "Properties": {
          "RestApiId": { "Ref": "BooksApi60AC975F" },
          "Description": "Automatically created by the RestApi construct" },
          "DependsOn": [
            "BooksApiANY0C4EABE3",
            "BooksApibooksGET6066BF7E",
            "BooksApibooks1F745538"
          ]
        },
        "BooksApiDeploymentStageprod0693B760": {
          "Type": "AWS::ApiGateway::Stage",
          "Properties": {
            "RestApiId": { "Ref": "BooksApi60AC975F" },
            "DeploymentId": { "Ref": "BooksApiDeployment86CA39AF794fe41ee968b295eca9a15ee72a4a7c" },
            "StageName": "prod"
          }
        },
        "BooksApiCloudWatchRoleB120ADBA": {
          "Type":"AWS::IAM::Role",
          "Properties": {
            "AssumeRolePolicyDocument":{ 
              "Statement": [
                {
                  "Action": "sts:AssumeRole",
                  "Effect": "Allow",
                  "Principal": {"Service":"apigateway.amazonaws.com"}
                }
              ],
              "Version": "2012-10-17"
            },
            "ManagedPolicyArns": [
              {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    { "Ref": "AWS::Partition" },
                    ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs"
                  ]
                ]
              }
            ]
          }
        },
        "BooksApiAccount9C44AF8E": {
          "Type": "AWS::ApiGateway::Account",
          "Properties": {
            "CloudWatchRoleArn": {
              "Fn::GetAtt": [ "BooksApiCloudWatchRoleB120ADBA", "Arn" ]
            }
          },
          "DependsOn":[ "BooksApi60AC975F" ]
        },
        "BooksApiANY0C4EABE3": {
          "Type": "AWS::ApiGateway::Method",
          "Properties": {
            "HttpMethod": "ANY",
            "ResourceId": {
              "Fn::GetAtt": [ "BooksApi60AC975F","RootResourceId" ]
            },
            "RestApiId": { "Ref":"BooksApi60AC975F" },
            "AuthorizationType": "NONE",
            "Integration": { "Type": "MOCK" }
          }
        },
        "BooksApibooks1F745538": {
          "Type": "AWS::ApiGateway::Resource",
          "Properties": {
            "ParentId": {
              "Fn::GetAtt":[ "BooksApi60AC975F", "RootResourceId" ]
            },
            "PathPart": "books",
            "RestApiId": { "Ref": "BooksApi60AC975F" }
          }
        },
        "BooksApibooksGET6066BF7E": {
          "Type": "AWS::ApiGateway::Method",
          "Properties": {
            "HttpMethod": "GET",
            "ResourceId": { "Ref": "BooksApibooks1F745538" },
            "RestApiId": { "Ref": "BooksApi60AC975F" },
            "AuthorizationType": "NONE",
            "Integration": {
              "IntegrationHttpMethod": "POST",
              "Type": "AWS_PROXY",
              "Uri": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    { "Ref":"AWS::Partition" },
                    ":apigateway:",
                    { "Ref": "AWS::Region" },
                    ":lambda:path/2015-03-31/functions/",
                    { "Fn::ImportValue": "FirstStack:ExportsOutputFnGetAttfirstLambda395F9ADEArn1A9B3BC3" },
                    "/invocations"
                  ]
                ]
              }
            }
          }
        },
        "BooksApibooksApiPermissionSecondStackBooksApi2660DEC5GETbooks3E9C9389": {
          "Type": "AWS::Lambda::Permission",
          "Properties": {
            "Action": "lambda:InvokeFunction",
            "FunctionName": { "Fn::ImportValue": "FirstStack:ExportsOutputFnGetAttfirstLambda395F9ADEArn1A9B3BC3" },
            "Principal":"apigateway.amazonaws.com",
            "SourceArn": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  { "Ref": "AWS::Partition" },
                  ":execute-api:",
                  { "Ref": "AWS::Region" },
                  ":",
                  { "Ref": "AWS::AccountId" },
                  ":",
                  { "Ref": "BooksApi60AC975F" },
                  "/",
                  { "Ref": "BooksApiDeploymentStageprod0693B760" },
                  "/GET/books"
                ]
              ]
            }
          }
        },
        "BooksApibooksApiPermissionTestSecondStackBooksApi2660DEC5GETbooks40D42DF6": {
          "Type": "AWS::Lambda::Permission",
          "Properties": {
            "Action": "lambda:InvokeFunction",
            "FunctionName": { "Fn::ImportValue": "FirstStack:ExportsOutputFnGetAttfirstLambda395F9ADEArn1A9B3BC3" },
            "Principal": "apigateway.amazonaws.com",
            "SourceArn": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  { "Ref": "AWS::Partition" },
                  ":execute-api:",
                  { "Ref": "AWS::Region" },
                  ":",
                  { "Ref": "AWS::AccountId" },
                  ":",
                  { "Ref": "BooksApi60AC975F" },
                  "/test-invoke-stage/GET/books"
                ]
              ]
            }
          }
        }
      },
      "Outputs": {
        "BooksApiEndpointF2AA70A2": {
          "Value": {
            "Fn::Join": [
              "",
              [
                "https://",
                { "Ref": "BooksApi60AC975F" },
                ".execute-api.",
                { "Ref": "AWS::Region" },
                ".",
                { "Ref": "AWS::URLSuffix" },
                "/",
                { "Ref": "BooksApiDeploymentStageprod0693B760" },
                "/"
              ]
            ]
          }
        }
      }
  }
]